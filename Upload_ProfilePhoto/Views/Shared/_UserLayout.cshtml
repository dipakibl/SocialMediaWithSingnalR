@using Microsoft.AspNetCore.Http;
@using Microsoft.AspNetCore.Identity;
<!DOCTYPE html>
<style>
    .notification .badge {
        position: absolute;
        top: -18px;
        left: -11px;
        padding: 3px 10px;
        border-radius: 50%;
        background-color: #1d22d2;
        color: white;
        position: relative;
        width: 30px;
        height: 22px;
        font-size: 16px;
    }

    .messagenoti {
        bottom: 22px;
        right: 10px;
        padding: 2px 10px;
        border-radius: 100%;
        background-color: #1d22d2;
        color: white;
        position: relative;
        width: 29px;
        height: 21px;
        font-size: 16px;
    }

    .imgstyle {
        height: 50px;
        width: 50px;
        margin: 2px 0px 0px;
    }

    .likeclass {
        color: red !important;
    }

    .unlikeclass {
        color: #212529;
    }

    .scrollbar {
        height: 250px;
        overflow: auto;
        margin-bottom: 25px;
    }

    #style-4::-webkit-scrollbar {
        width: 5px;
        background-color: #929394;
    }

    #style-4::-webkit-scrollbar-thumb {
        background-color: #bacee2;
        border: 2px solid #bacee2;
    }

    .notificationscrollbar {
        height: 350px;
        overflow: auto;
    }

    #nottlist::-webkit-scrollbar {
        width: 4px;
        background-color: #f5b9b1;
    }

    #nottlist::-webkit-scrollbar-thumb {
        background-color: #e44d3a;
        border: 2px solid #e44d3a;
    }

    #messageNotification::-webkit-scrollbar {
        width: 4px;
        background-color: #f5b9b1;
    }

    #messageNotification::-webkit-scrollbar-thumb {
        background-color: #e44d3a;
        border: 2px solid #e44d3a;
    }

    .Del-Post {
        position: absolute;
        top: 100%;
        right: 0;
        width: 130px;
        background-color: #fff;
        -webkit-box-shadow: 0 0 10px rgba(0,0,0,0.28);
        -moz-box-shadow: 0 0 10px rgba(0,0,0,0.28);
        -ms-box-shadow: 0 0 10px rgba(0,0,0,0.28);
        -o-box-shadow: 0 0 10px rgba(0,0,0,0.28);
        box-shadow: 0 0 10px rgba(0,0,0,0.28);
        padding: 20px;
        opacity: 1;
        visibility: visible;
        z-index: 999;
    }

        .Del-Post li {
            float: left;
            width: 100%;
            margin-bottom: 15px;
        }

            .Del-Post li a {
                color: #686868;
                font-size: 14px;
                font-weight: 600;
            }

    .NotifiButton {
        color: #fff;
        background-color: #53d690;
        text-transform: capitalize;
        padding: 5px 13px;
        border-radius: 3px;
        display: inline-block;
        font-size: 14px;
        font-weight: 500;
    }

    .messageNotiisonline {
        border-radius: 100px;
        background-color: #28a745;
        position: relative;
        width: 10px;
        height: 10px;
    }
</style>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link rel="stylesheet" type="text/css" href="~/temp/css/animate.css">
    <link rel="stylesheet" type="text/css" href="~/temp/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="~/temp/css/line-awesome.css">
    <link rel="stylesheet" type="text/css" href="~/temp/css/line-awesome-font-awesome.min.css">
    <link href="~/temp/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" type="text/css" href="~/temp/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="~/temp/css/jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" type="text/css" href="~/temp/lib/slick/slick.css">
    <link rel="stylesheet" type="text/css" href="~/temp/lib/slick/slick-theme.css">
    <link rel="stylesheet" type="text/css" href="~/temp/css/style.css">
    <link rel="stylesheet" type="text/css" href="~/temp/css/responsive.css">
    <link href="~/temp/jquery-confirm/jquery-confirm.min.css" rel="stylesheet" />

</head>

<body oncontextmenu="return false;">
    <audio id="myAudio">
        <source src="~/Audio/that-was-quick.ogg" type="audio/ogg" />
        <source src="~/Audio/that-was-quick.mp3" type="audio/mpeg" />
    </audio>
    <div class="wrapper">
        <header>
            <div class="container">
                <div class="header-data">
                    <nav>
                        <ul>
                            <li>
                                <a href="/Home/Index" title="">
                                    <span><img src="~/temp/images/icon1.png" alt=""></span>
                                    Home
                                </a>
                            </li>
                            <li>
                                <a href="/Home/Profile" title="">
                                    <span><img src="~/temp/images/icon4.png" alt=""></span>
                                    Profiles
                                </a>
                            </li>
                            <li>
                                <a href="/Friends/MyFriends" title="">
                                    <span><img src="~/temp/images/icon4.png" alt=""></span>
                                    Friends
                                </a>
                            </li>
                            <li>
                                <p hidden="hidden" id="user"></p>
                                <input type="hidden" id="signalRConnectionId" />
                                <a href="javascript:void(0)" title="" class="not-box-open notification">
                                    <span><img src="~/temp/images/icon7.png" alt=""></span>
                                    Notification

                                    <span class="badge" id="Notticount"></span>
                                </a>
                                <div class="notification-box noti" style="width:350px" id="notification">
                                    <div class="nt-title">
                                        <h4>Setting</h4>
                                        <a href="#" title="">Clear all</a>
                                    </div>
                                    <div class="nott-list">
                                        <div id="nottlist" class="notificationscrollbar listsss">

                                        </div>
                                        <div class="view-all-nots">
                                            <a href="#" title="">View All Notification</a>
                                        </div>
                                    </div><!--nott-list end-->
                                </div>
                            </li>
                            <li>
                                <a href="javascript:void(0)" title="" class="not-box-openm">
                                    <span><img src="~/temp/images/icon6.png" alt=""></span>
                                    Messages
                                    <span class="badge messagenoti" id="MessageNotticount" style="border-radius: 100%;font-size: 16px;padding: 2px;"></span>
                                </a>
                                <div class="notification-box msg" id="message">
                                    <div class="nt-title">
                                        <h4>Setting</h4>
                                        <a href="#" title="">Clear all</a>
                                    </div>
                                    <div class="nott-list">
                                        <div id="messageNotification" class="notificationscrollbar listsss">

                                        </div>
                                        <div class="view-all-nots">
                                            <a href="/Message/Index" title="">View All Messsages</a>
                                        </div>
                                    </div><!--nott-list end-->
                                </div><!--notification-box end-->
                            </li>
                        </ul>
                    </nav><!--nav end-->
                    <div class="menu-btn">
                        <a href="#" title=""><i class="fa fa-bars"></i></a>
                    </div><!--menu-btn end-->
                    <div class="user-account">
                        <div class="user-info">
                            @if (Context.Session.GetString("UserId") == null)
                            {
                                Context.Response.Redirect("/User/Login");
                            }
                            <a href="#" title="">@Context.Session.GetString("UserName")</a>
                            <i class="la la-sort-down"></i>
                        </div>
                        <div class="user-account-settingss" id="users">
                            <h3 class="tc"><a href="https://localhost:44329/User/LogOut" title="">Logout</a></h3>
                        </div><!--user-account-settingss end-->
                    </div>
                </div><!--header-data end-->
            </div>
        </header><!--header end-->
        @RenderBody()
    </div><!--theme-layout end-->
    <script type="text/javascript" src="~/temp/js/jquery.min.js"></script>
    <script type="text/javascript" src="~/temp/js/popper.js"></script>
    <script type="text/javascript" src="~/temp/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="~/temp/js/jquery.mCustomScrollbar.js"></script>
    <script type="text/javascript" src="~/temp/lib/slick/slick.min.js"></script>
    <script type="text/javascript" src="~/temp/js/scrollbar.js"></script>
    <script type="text/javascript" src="~/temp/js/script.js"></script>
    <script src="~/temp/jquery-confirm/jquery-confirm.min.js"></script>
    <script src="~/temp/toastr.js/toastr.min.js"></script>
    <script src="~/lib/signalr/signalr.js"></script>
    <script>
         var CurUserId = @Context.Session.GetString("UserId");
        document.getElementById("user").innerHTML = "UserId: " + CurUserId;
        $(document).ready(function () {
            var connection = new signalR.HubConnectionBuilder().withUrl("/NotificationHub?userId=" + CurUserId).build();
            connection.on("sendToUser", (Type) => {
                GetNotificaiton();
                playsoundaudio();
            });
            connection.on("sendToMessage", (Message, FriendId, UserId, userAvtart) => {

                  $("#Messagebox" + UserId).append('<div class="left-message"><div class="left-message-first"><div class="left-message-second"><p class="left-message-P">' + Message + '</p></div><span class="left-message-span">' + formatAMPM(new Date) + '</span><div class="left-message-image"><img src="https://localhost:44329/ProfilePhoto/' + userAvtart + '" alt=""></div></div></div>');
                  GetMYFrinedLastMessage();
                  GetAllFrinedLastMessage();
                  var activedivid = document.getElementById("StartChatUserId").textContent;
                  if (UserId == activedivid) {
                      MessageIsRead(UserId);
                  } else {
                        playsoundaudio();
                  }
                  var divsrc = document.getElementsByName("divmessagesboxdown");
                divsrc[0].scrollTop = divsrc[0].scrollHeight;;
            });
            connection.start().catch(function (err) {
                return console.error(err.toString());
            }).then(function () {
                $("#Notticount").hide();
                GetNotificaiton();
                GetMYFrinedLastMessage();
            });
        });
        function SCrollerlist() {
            //if (name==null) {
            //    var objDiv = document.getElementsByName("divMessagebox");
            //    var container = document.querySelector(".dc-messages-container");
            //} else {
            //      var objDiv = document.getElementsByName(name);
            //}
      var objDiv = document.getElementsByClassName(".scrollbar");
        objDiv.scrollTop  = objDiv.scrollHeight;
        }
        function playsoundaudio() {
            var x = document.getElementById("myAudio");
            x.play();
        }
         function GetNotificaiton() {
        $.ajax({
            type: 'Get',
            url: '/Home/GetNotification',
            dataType: 'json',
            success: function (result) {
                $("#nottlist").empty();
                $.each(result, function (i, l) {
                    if (l.count!=0) {
                        $("#Notticount").show();
                         $("#Notticount").text(l.count);
                    }
                    else {
                         $("#Notticount").hide();
                    }

                    if (l.type=="1") {
                         if (l.isRead == false) {
                                        $("#nottlist").append('<div class="notfication-details" onclick="UpdateNotify('+l.notfID+')" style="background-color: #d8cfcf;"> <div class="noty-user-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userImage + '"  style="width: 38px; height: 38px; border-radius: 25px;" /></div><div class="notification-info" style="width: 75%;"> <h3><a href="/Home/UserProfile/'+l.friendId+'" title="">' + l.userName + '</a> Commented on your photo.: <b style="font-weight: bold;"> '+l.commentMessage+'</b>.</h3><span style="position: inherit;">'+ConvertDate(l.createdDate)+' ago</span></div><!--notification-info --><img src="https://localhost:44329/ProfilePhoto/' + l.picture + '" style="width: 38px; height: 38px; border-radius: 25px; float: right;"/></div>');
                                                 }
                         else if (l.isRead==true) {
                                         $("#nottlist").append('<div class="notfication-details"  > <div class="noty-user-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userImage + '"  style="width: 38px; height: 38px; border-radius: 25px;"/></div><div class="notification-info" style="width: 75%;"> <h3><a href="/Home/UserProfile/'+l.friendId+'" title="">' + l.userName + '</a> Commented on your photo.: <b style="font-weight: bold;">'+l.commentMessage+'.</b></h3><span style="position: inherit;">'+ConvertDate(l.createdDate)+' ago</span></div><!--notification-info --><img src="https://localhost:44329/ProfilePhoto/' + l.picture + '"  style="width: 38px; height: 38px; border-radius: 25px; float: right;" /></div>');
                                                 }
                                    }
                    else  if (l.type == "2") {
                              if (l.isRead == false) {
                         $("#nottlist").append('<div class="notfication-details" onclick="UpdateNotify('+l.notfID+')" style="background-color: #d8cfcf;"> <div class="noty-user-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userImage + '"  style="width: 38px; height: 38px; border-radius: 25px;"/></div><div class="notification-info" style="width: 87%;"> <h3><a href="/Home/UserProfile/'+l.friendId+'" title="">' + l.userName + '</a>&nbsp; sent you friend request.</h3><span style="position: inherit;">'+ConvertDate(l.createdDate)+' ago</span><div id="notibutton'+l.friendId+'"><a href="#" class="NotifiButton" style="margin-left: 5px;" onclick="ResponseToFriendRequest('+l.friendId+','+true+')">Accept</a>&nbsp;<a href="#" class="NotifiButton" style="background-color: #e44d3a;" onclick="ResponseToFriendRequest('+l.friendId+','+false+')">Decline</a></div></div></div>');
                                                 }
                              else if (l.isRead==true) {
                        $("#nottlist").append('<div class="notfication-details"  > <div class="noty-user-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userImage + '"  style="width: 38px; height: 38px; border-radius: 25px;"/></div><div class="notification-info" style="width: 87%;"> <h3><a href="/Home/UserProfile/'+l.friendId+'" title="">' + l.userName + '</a>&nbsp; sent you friend request.</h3><span style="position: inherit;">'+ConvertDate(l.createdDate)+' ago</span><div id="notibutton'+l.friendId+'"><a href="#" class="NotifiButton" style="margin-left: 5px;" onclick="ResponseToFriendRequest('+l.friendId+','+true+')">Accept</a>&nbsp;<a href="#" class="NotifiButton" style="background-color: #e44d3a;" onclick="ResponseToFriendRequest('+l.friendId+','+false+')">Decline</a></div></div></div>');
                                                }
                    }
                         else  if (l.type == "3") {
                              if (l.isRead == false) {
                         $("#nottlist").append('<div class="notfication-details" onclick="UpdateNotify('+l.notfID+')" style="background-color: #d8cfcf;"> <div class="noty-user-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userImage + '"  style="width: 38px; height: 38px; border-radius: 25px;"/></div><div class="notification-info" style="width: 87%;"> <h3><a href="/Home/UserProfile/'+l.friendId+'" title="">' + l.userName + '</a>&nbsp; Accepted your friend request.</h3><span style="position: inherit;">'+ConvertDate(l.createdDate)+' ago</span></div></div>');
                                                 }
                              else if (l.isRead==true) {
                        $("#nottlist").append('<div class="notfication-details"  > <div class="noty-user-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userImage + '"  style="width: 38px; height: 38px; border-radius: 25px;"/></div><div class="notification-info" style="width: 87%;"> <h3><a href="/Home/UserProfile/'+l.friendId+'" title="">' + l.userName + '</a>&nbsp; Accepted your friend request.</h3><span style="position: inherit;">'+ConvertDate(l.createdDate)+' ago</span></div></div>');
                                                }
                        }
                        else {
                              if (l.isRead == false) {
                         $("#nottlist").append('<div class="notfication-details" onclick="UpdateNotify('+l.notfID+')" style="background-color: #d8cfcf;"> <div class="noty-user-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userImage + '"  style="width: 38px; height: 38px; border-radius: 25px;"/></div><div class="notification-info" style="width: 75%;"> <h3><a href="/Home/UserProfile/'+l.friendId+'" title="">' + l.userName + '</a> LIked your photo.</h3><span style="position: inherit;">'+ConvertDate(l.createdDate)+' ago</span></div><!--notification-info --><img src="https://localhost:44329/ProfilePhoto/' + l.picture + '" style="width: 38px;height: 38px; border-radius: 25px; float: right;"/></div>');
                                                     }
                              else if (l.isRead==true) {
                            $("#nottlist").append('<div class="notfication-details"  > <div class="noty-user-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userImage + '"  style="width: 38px; height: 38px; border-radius: 25px;"/></div><div class="notification-info" style="width: 75%;"> <h3><a href="/Home/UserProfile/'+l.friendId+'" title="">' + l.userName + '</a> LIked your photo.</h3><span style="position: inherit;">'+ConvertDate(l.createdDate)+' ago</span style="position: inherit;"></div><!--notification-info --><img src="https://localhost:44329/ProfilePhoto/' + l.picture + '" style="width: 38px; height: 38px; border-radius: 25px; float: right;"/></div>');
                                                        }
                            }


                })
                GetAllComments();
                GetAllLiker();
            }
        });
        }
        function UpdateNotify(notfID) {
            $.ajax({
            async: true,
            type: "POST",
            url: '/Home/UpdateNotification',
            data: {
                NotifyId: notfID
            },
                success: function (result) {
                GetNotificaiton();
            }
        });

        }
        function GetMYFrinedLastMessage() {
        $.ajax({
            type: 'Get',
            url: '/Message/GetLastMessageByCurrentUser',
            dataType: 'json',
            success: function (result) {
                let notificount =0;
                //$("#MyFriendListhideshow").show();
                $.each(result, function (i, l) {
                    $("#messageNotification").empty();
                })
                $.each(result, function (i, l) {
                    $("#messageNotification").append(' <div class="notfication-details" onclick="MessageNotificationSetSentMsg(' + l.id + ')"><div class="noty-user-img"><img src="https://localhost:44329/ProfilePhoto/' + l.friend.avtart + '" style="border-radius: 100%;" alt=""><span title="is Online" id="Notiisonline' + l.friend.id + '"></span></div><div class="notification-info"><h3 id="friendName' + l.id + '"><a href="javascript:void(0)" title="">' + l.friend.userName + '</a> </h3><b id="you' + l.lastMessageId + '"></b><p id="p' + l.lastMessageId + '">' + l.lastMessage + '</p><span id="notificationsecond'+l.id+'">'+ConvertDate(l.messageDatetime)+' ago</span><span class="msg-notifc" id="FriendCountNoti'+l.friend.id+'" style="margin-top: 18px;color:#fff;">'+l.count+'</span></div></div>');
                    if (l.isRead == false) {
                        $("#p" + l.lastMessageId).css({ "font-weight": "bold", "color": "red" });
                    }
                    if (l.lastSender != l.friend.id) {
                        $("#you" + l.lastMessageId).text("You: ");
                    }
                    if (l.isOnline == true) {
                        $("#Notiisonline" + l.friend.id).addClass("messageNotiisonline");
                        $("#ActiveStatus").text("Online");
                    }
                    if (l.count == 0) {
                        $("#FriendCountNoti" + l.friend.id).hide();
                    }

                    var notsound = $("#notificationsecond" + l.id).text();
                    if (notsound == "0 seconds ago" && l.count != 0) {
                        playsoundaudio();
                    }
                     if (notsound == "1 seconds ago" && l.count != 0) {
                        playsoundaudio();
                    }

                  notificount =  notificount + l.count;
                });
                if (notificount !=0) {
                     $("#MessageNotticount").text(notificount);
                }
               

            }
        });
        }
        function MessageNotificationSetSentMsg(id) {
            sessionStorage.setItem("reloading", "true");
            sessionStorage.setItem("FreindId", id);
             window.location = '/Message/Index';
            SetSentMsg(id);
        }
          function ConvertDate(dateStr) {
        var date = new Date(dateStr);
        var seconds = Math.floor((new Date() - date) / 1000);
  var interval = Math.floor(seconds / 31536000);
  if (interval > 1) {
    return interval + " years";
  }
  interval = Math.floor(seconds / 2592000);
          if (interval > 1) {
              if (interval > 12) {
                  return  "1 years";
              }
    return interval + " months";
  }
  interval = Math.floor(seconds / 86400);
          if (interval > 1) {
      if (interval > 31) {
                  return  "1 months";
              }
    return interval + " days";
  }
  interval = Math.floor(seconds / 3600);
  if (interval > 1) {
    return interval + " hours";
  }
  interval = Math.floor(seconds / 60);
          if (interval > 1) {
      if (interval > 60) {
                  return  "1 hours";
              }
    return interval + " minutes";
        }
        if (seconds > 60) {
            return "1 minute";
        }
  return Math.floor(seconds) + " seconds";

        }
         function InviteFriend(Id) {
        //var className = $('#Suggest'+Id).attr('class');
        //if (className == "la la-check") {
        //    CancelSendInviteRequest(Id);
        //    return;
        //}
        var friend = {};
        friend.FrindUserId = Id;
         $.ajax({
            async: true,
            type: "POST",
            url: '/Friends/InviteFriend',
            data: {
                friend: friend
            },
             success: function (result) {

                 if (result.success) {
                      $("#onclickInviteButton"+Id).attr("onclick","CancelSendInviteRequest("+Id+")");
                     $('#Suggest' + result.data.userId).attr('class', 'la la-check');
                      $("#AddFriendButton" + Id).empty();
                     $("#AddFriendButton" + Id).append('<a href="javascript:void(0)" id="onclickInviteButton'+Id+'" class="NotifiButton" onclick="CancelSendInviteRequest(' + Id + ')" style="background-color: #dbdbef;width: 126px;height: 27px;font-size: 15px;">Cancle Request</a>');
                 } else {
                      toastr.error(result.errorMessage);
                 }
            }
        });
    }
    function CancelSendInviteRequest(Id) {
         var friend = {};
        friend.FrindUserId = Id;
         $.ajax({
            async: true,
            type: "POST",
            url: '/Friends/CancelSendRequest',
            data: {
                friend: friend
            },
             success: function (result) {
                 if (result.success) {
                      $("#onclickInviteButton"+Id).attr("onclick","InviteFriend("+Id+")");
                     $('#Suggest' + result.data.userId).attr('class', 'la la-plus');
                     $("#AddFriendButton" + Id).empty();
                     $("#AddFriendButton" + Id).append('<a href="javascript:void(0)" id="onclickInviteButton'+Id+'" class="NotifiButton" onclick="InviteFriend(' + Id + ')" style="background-color: #5d5def;width: 114px;height: 27px;font-size: 15px;">Add Friend</a>');

                 } else {
                      toastr.error(result.errorMessage);
                 }
            }
        });
    }
    function ResponseToFriendRequest(id, status) {
        var friend = {};
        friend.FrindUserId = id;
        friend.Confirmed = status;
         $.ajax({
            async: true,
            type: "POST",
            url: '/Friends/ResponseFriendRequest',
            data: {
                friend: friend
            },
             success: function (result) {
                 if (result.data == null) {
                     toastr.info(result.errorMessage);
                 }
                 if (status == true) {

                     $("#AcceptDeclinebutton" + id).empty();
                     $("#AcceptDeclinebutton" + id).append("<span style='display: contents;color: #b2b2b2;font-size: 13px;font-weight: 600;'>You are now friends</span>");
                     $("#notibutton" + id).empty();
                     $("#notibutton" + id).append("<span style='display: contents;color: #b2b2b2;font-size: 13px;font-weight: 600;'>You are now friends</span>");
                 } else {
                      $("#AcceptDeclinebutton" + id).empty();
                     $("#AcceptDeclinebutton" + id).append("<span style='display: contents;color: #b2b2b2;font-size: 13px;font-weight: 600;'>Request Declinded</span>");
                      $("#notibutton" + id).empty();
                     $("#notibutton" + id).append("<span style='display: contents;color: #b2b2b2;font-size: 13px;font-weight: 600;'>Request Declinded</span>");
                 }


            }
        });
        }
         function GetAllLiker() {
        $.ajax({
            type: 'Get',
            url: '/Home/GetAllLIker',
            dataType: 'json',
            success: function (result) {
                $.each(result, function (i, l) {
                    $('#' + l.pictureId).text(l.totalLIkes);
                    if (l.currUserLike) {
                        var yourClass = $('#likeid' + l.pictureId).prop("class");
                        $('#likeid' + l.pictureId).removeClass(yourClass).addClass('likeclass');
                    }
                })
            }
        });
        }
         function GetAllComments() {
        $.ajax({
            type: 'Get',
            url: '/Home/GetAllComments',
            dataType: 'json',
            success: function (result) {
                $.each(result, function (i, l) {
                    $("#commentlist" + l.commentPitcureId).empty();
                })
                $.each(result, function (i, l) {
                    $("#commentcount" + l.commentPitcureId).text(l.totalComment);
                    $("#commentlist" + l.commentPitcureId).append('<li id="li' + l.commentId + '"><div class="comment-list" id="commentlist"style="display: inline-flex;"><div class="bg-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userPicture + '" alt="" style="height: 36px;width: 50px;"></div><div class="comment"><div class="row" style="margin: 0;"><h3 id="CommentedUserName'+l.commentId+'"><a href="/Home/UserProfile/'+l.userid+'">' + l.userName + '</a></h3><div class="ed-opts" id="buttons' + l.commentId + '" style="display: none; margin: 0 0 0 250px;"><a href="javascript:void(0)" onclick="$( ' + "'" + '#EditDeleteButton' + l.commentId + '' + "'" + ').toggle()" title="" class="ed-opts-open"><i class="la la-ellipsis-v"></i></a><ul class="Del-Post" id="EditDeleteButton' + l.commentId + '" style="display: none;"><li style="margin: -16px 0 0 -25px;"><a href="javascript:void(0)" onclick="EditComment(' + l.commentId + ',' + l.commentPitcureId + ')" title="">Edit</a></li><li style="/* margin-bottom: 25px; */margin: 4px 0 0 -25px;"><a href="javascript:void(0)" onclick="DeleteComment(' + l.commentId + ')" title="">Delete</a></li></ul></div></div><span><img src="https://localhost:44329/temp/images/clock.png" alt=""> ' + ConvertDate(l.createdDate) + ' ago</span><p id="txtcomm' + l.commentId + '">' + l.message + '</p><a href="javascript:void(0)" title="" id="Commentlikeid' + l.commentId + '" class="unlikeclass"  onclick="CommentLikeProcess(' + l.commentId + ')"><i class="fa fa-heart"></i>Like</a>&nbsp;<b id="CommentLikeCount' + l.commentId + '" style="color: #b2b2b2;font-weight: 600;"></b>&nbsp;&nbsp;<a href="javascript:void(0)" onclick="SetCommentReply(' + l.commentId+ ',' +l.commentPitcureId+ ');" title=""><i class="fa fa-reply-all"></i>Reply</a><br /><a href="javascript:void(0)" onclick="$( ' + "'" + '#Replaycommentlist' + l.commentId + '' + "'" + ').toggle()">replies&nbsp; <b  id="replies' + l.commentId + '"></b></a><ul id="Replaycommentlist' + l.commentId + '" style="display: none;" ></ul></div></div></li>');
                    if (l.userid == CurUserId) {
                        $("#buttons" + l.commentId).show();
                    }
                });
              //  scrollDown();
                GetCommentReplayes();
            }
        });
        }
         function SendComment(id) {
        var comment = {};
        comment.Id =  $("#txtCommentId"+id).val();
        comment.Message = $('#txtComment' + id).val();
        comment.PictureId = $('#txtpictureid' + id).val();
        if (comment.Message == "") {
            return;
        }
        if (comment.PictureId == "") {
            return;
        }
        $.ajax({
            async: true,
            type: "POST",
            url: '/Home/SendComment',
            data: {
                comments: comment

            },
            success: function (result) {
                $('#txtComment' + id).val("");
                $('#txtCommentId' + id).val("");
                 $('#Editing'+comment.PictureId).empty();
                GetAllComments();

            },
            error: function () {
            }
        });
    }

         function GetCommentReplayes() {
         $.ajax({
            type: 'Get',
            url: '/Home/GetAllCommentReplayes',
            dataType: 'json',
             success: function (result) {
                  $.each(result, function (i, l) {
                    $("#Replaycommentlist" + l.commentId).empty();
                })
                 $.each(result, function (i, l) {
                     $("#Replaycommentlist" + l.commentId).append('<li id="Replaylist'+l.replyCommentId+'"><div class="comment-list"  style="display: inline-flex;"><div class="bg-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userPicture + '" alt="" style="height: 36px;width: 50px;"></div><div class="comment"><div class="row" style="margin: 0;"><h3 ><a href="/Home/UserProfile/'+l.userid+'">' + l.userName + '</a></h3><div class="ed-opts" id="CommentReplayButton'+l.replyCommentId+'" style="display: none; margin: -16px 0px 0px 200px;"><a href="javascript:void(0)" onclick="$('+"'" +'#ComReplyEditDeleteButton'+l.replyCommentId+''+"'"+').toggle()" title="" class="ed-opts-open"><i class="la la-ellipsis-v"></i></a><ul class="Del-Post" id="ComReplyEditDeleteButton'+l.replyCommentId+'" style="display: none;"><li style="margin: -16px 0 0 -25px;"><a href="javascript:void(0)" onclick="EditCommentReplay(' + l.replyCommentId + ',' + l.commentId + ',' + l.commentPitcureId + ')" title="">Edit</a></li><li style="margin: 4px 0 0 -25px;"><a href="javascript:void(0)" onclick="DeleteCommentReplay(' + l.replyCommentId + ')" title="">Delete</a></li></ul></div></div><span><img src="https://localhost:44329/temp/images/clock.png" alt=""> ' + ConvertDate(l.createdDate) + ' ago</span><p id="txtcommReplay'+l.replyCommentId+'">' + l.message + '</p></div></div></li>');
                     $("#replies" + l.commentId).text(l.totalComment);
                     if (l.userid == CurUserId) {
                         $("#CommentReplayButton" + l.replyCommentId).show();
                     }
                 });
                // scrollDown();
                 GetAllCommentsLikes();
            }
        });
        }
        // function scrollDown() {
        //var objDiv = $( "#style-4" ).get( 0 );
        //objDiv.scrollTop = objDiv.scrollHeight;
        //}
         function GetAllCommentsLikes() {
        $.ajax({
            type: 'Get',
            url: '/Home/GetAllCommentLikes',
            dataType: 'json',
            success: function (result) {
                $.each(result, function (i, l) {
                    $('#CommentLikeCount' + l.commentId).text(l.totalLike);
                    if (l.currentUserLike) {
                        var yourClass = $('#Commentlikeid' + l.commentId).prop("class");
                        $('#Commentlikeid' + l.commentId).removeClass(yourClass).addClass('likeclass');
                    }
                })
            }
        })
        }
         function DeleteComment(commentId) {
         $.confirm({
                    title: 'Confirm!',
                    content: 'Are you sure you want to delete this Comment?',
                    buttons: {
                        confirm: function () {

                            $.ajax({
            async: true,
            type: "POST",
            url: '/Home/DeleteComment',
            data: {
                CommentId: commentId

            },
              success: function (result) {
                  $("#li" + result.id).empty();
                $('#txtCommentId' + result.pictureId).val("");
                  GetNotificaiton();
                  toastr.success("Comment Deleted.!")

            },
                                error: function () {
                toastr.error("Error, Unsuccess in deleting comment.")
            }
        });

                        },
                        cancel: function () {

                        },
                    }

                });

    }
    function EditComment(commentId, picureid) {
        $('#Editing' + picureid).empty();
        $('#Editing'+picureid).append('<span style="">Editing to this Comment.</span>&nbsp;<a href="javascript:void(0)" onclick="CancelForm('+picureid+');">Cancel</a></div>');
        $("#txtCommentId"+picureid).val(commentId);
        var text = $("#txtcomm" + commentId).text();
        $('#txtComment' + picureid).val(text);

    }
    function CancelForm(picureid) {
        $("#changeonclick"+picureid).attr("onclick","SendComment("+picureid+")");
        $("#txtCommentId" + picureid).val("");
        $('#txtComment' + picureid).val("");
         $("#txtCommentReplayId"+picureid).val("");
         $('#Editing'+picureid).empty();
    }
    function SetCommentReply(CommentId, picureid) {
        $('#Editing' + picureid).empty();
        var UserName = document.getElementById('CommentedUserName' + CommentId).textContent;
        $('#Editing'+picureid).append('<span style="">Replying to </span><b style="font-weight: bold;">'+UserName+'</b>&nbsp;<a href="javascript:void(0)" onclick="CancelForm('+picureid+');">Cancel</a></div>');
         $("#txtCommentId"+picureid).val(CommentId);
        $("#changeonclick"+picureid).attr("onclick","SendReplayComment("+picureid+")");
    }
    function EditCommentReplay(commentReplayId, CommentId,commentPitcureId) {
        $('#Editing' + commentPitcureId).empty();
        $('#Editing'+commentPitcureId).append('<span style="">Editing to this Comment.</span>&nbsp;<a href="javascript:void(0)" onclick="CancelForm('+commentPitcureId+');">Cancel</a></div>');
        $("#txtCommentId" + commentPitcureId).val(CommentId);
        $("#txtCommentReplayId"+commentPitcureId).val(commentReplayId);
        var text = $("#txtcommReplay" + commentReplayId).text();
        $('#txtComment' + commentPitcureId).val(text);
         $("#changeonclick"+commentPitcureId).attr("onclick","SendReplayComment("+commentPitcureId+")");

    }
    function SendReplayComment(id) {
        var comment = {};
        comment.Id = $("#txtCommentReplayId"+id).val();
        comment.PictureCommentId =  $("#txtCommentId"+id).val();
        comment.Message = $('#txtComment' + id).val();
        if (comment.Message == "") {
            return;
        }
        if (comment.PictureCommentId == "") {
            return;
        }
         $.ajax({
            async: true,
            type: "POST",
            url: '/Home/SendCommentReplay',
            data: {
                comments: comment
            },
             success: function (result) {
                 CancelForm(id);
                 GetCommentReplayes();

            },
        });
    }
    //function GetCommentReplayes() {
    //     $.ajax({
    //        type: 'Get',
    //        url: '/Home/GetAllCommentReplayes',
    //        dataType: 'json',
    //         success: function (result) {
    //              $.each(result, function (i, l) {
    //                $("#Replaycommentlist" + l.commentId).empty();
    //            })
    //             $.each(result, function (i, l) {
    //                 $("#Replaycommentlist" + l.commentId).append('<li id="Replaylist'+l.replyCommentId+'"><div class="comment-list"  style="display: inline-flex;"><div class="bg-img"><img src="https://localhost:44329/ProfilePhoto/' + l.userPicture + '" alt="" style="height: 36px;width: 50px;"></div><div class="comment"><div class="row" style="margin: 0;"><h3 >' + l.userName + '</h3><div class="ed-opts" id="CommentReplayButton'+l.replyCommentId+'" style="display: none; margin: -16px 0px 0px 200px;"><a href="javascript:void(0)" onclick="$('+"'" +'#ComReplyEditDeleteButton'+l.replyCommentId+''+"'"+').toggle()" title="" class="ed-opts-open"><i class="la la-ellipsis-v"></i></a><ul class="Del-Post" id="ComReplyEditDeleteButton'+l.replyCommentId+'" style="display: none;"><li style="margin: -16px 0 0 -25px;"><a href="javascript:void(0)" onclick="EditCommentReplay(' + l.replyCommentId + ',' + l.commentId + ',' + l.commentPitcureId + ')" title="">Edit</a></li><li style="margin: 4px 0 0 -25px;"><a href="javascript:void(0)" onclick="DeleteCommentReplay(' + l.replyCommentId + ')" title="">Delete</a></li></ul></div></div><span><img src="https://localhost:44329/temp/images/clock.png" alt=""> ' + ConvertDate(l.createdDate) + ' ago</span><p id="txtcommReplay'+l.replyCommentId+'">' + l.message + '</p></div></div></li>');
    //                 $("#replies" + l.commentId).text(l.totalComment);
    //                 if (l.userid == CurUserId) {
    //                     $("#CommentReplayButton" + l.replyCommentId).show();
    //                 }
    //             });
    //             scrollDown();
    //             GetAllCommentsLikes();
    //        }
    //    });
    //}
    function CommentLikeProcess(id) {
        var likestf;
        $('#Commentlikeid' + id).toggleClass('likeclass unlikeclass');
        var yourClass = $('#Commentlikeid' + id).prop("class");
        if (yourClass == "likeclass") {
            likestf = true;
        }
        else if (yourClass == "unlikeclass") {
            likestf = false;
        }
        $.ajax({
            async: true,
            type: "POST",
            url: '/Home/CommentLike',
            data: {
                CommentId: id,
                like: likestf
            },
            success: function (result) {
                GetAllCommentsLikes();
            },
        });

    }
    //function GetAllCommentsLikes() {
    //    $.ajax({
    //        type: 'Get',
    //        url: '/Home/GetAllCommentLikes',
    //        dataType: 'json',
    //        success: function (result) {
    //            $.each(result, function (i, l) {
    //                $('#CommentLikeCount' + l.commentId).text(l.totalLike);
    //                if (l.currentUserLike) {
    //                    var yourClass = $('#Commentlikeid' + l.commentId).prop("class");
    //                    $('#Commentlikeid' + l.commentId).removeClass(yourClass).addClass('likeclass');
    //                }
    //            })
    //        }
    //    })
    //}
    function DeletePost(id) {
       $.confirm({
                    title: 'Confirm!',
                    content: 'Are you sure you want to delete this Post?',
                    buttons: {
                        confirm: function () {
                           $.ajax({
            async: true,
            type: "POST",
            url: '/Home/DeleteYourPost',
            data: {
                pictureId: id
            },
                               success: function (result) {
                   showprofiles();
                CurrentPrifile();
                  GetNotificaiton();
                  toastr.success("Deleted your selected Post.")

            },
                                error: function () {
                toastr.error("Error, Unsuccess in deleting this Post.")
            }
        });

                        },
                        cancel: function () {

                        },
                    }

                });
    }
     function DeleteCommentReplay(replyCommentId) {
         $.confirm({
                    title: 'Confirm!',
                    content: 'Are you sure you want to delete this Comment?',
                    buttons: {
                        confirm: function () {

                            $.ajax({
            async: true,
            type: "POST",
            url: '/Home/DeleteCommentReplay',
            data: {
                replyCommentId: replyCommentId
            },
                                success: function (result) {
                                    $("#Replaylist" + result.id).empty();
                                    let count = 0;
                                    let value =document.getElementById('replies'+result.pictureCommentId).textContent;
                                    count = (value - 1);
                                    $("#replies" + result.pictureCommentId).text(count);
                                    toastr.success("Comment Deleted.!")
            },
           error: function () {
                toastr.error("Error, Unsuccess in deleting comment.")
                              }
                                });
                                          },
                        cancel: function () {

                        },
                    }

                });

        }
        function formatJSONDate(jsonDate) {
            var date = new Date(jsonDate);
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? '0' + minutes : minutes;
            var strTime = hours + ':' + minutes + ' ' + ampm;
            return strTime;
        }
         function formatAMPM(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? '0' + minutes : minutes;
            var strTime = hours + ':' + minutes + ' ' + ampm;
            return strTime;
        }
    </script>

    <script>'undefined' === typeof _trfq || (window._trfq = []); 'undefined' === typeof _trfd && (window._trfd = []), _trfd.push({ 'tccl.baseHost': 'secureserver.net' }), _trfd.push({ 'ap': 'cpsh' }, { 'server': 'a2plcpnl0235' }) // Monitoring performance to make your website faster. If you want to opt-out, please contact web hosting support.</script>
</body>
</html>
